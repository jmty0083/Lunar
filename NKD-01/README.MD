# About NKD Dataset
## Source Dataset
There are multiple public datasets from network-based IDS[1], which can be divided into three major types:
1. Generated in an emulated environment with events from a shell scripts launched by the dataset collector.
1. Pure real world logs collected from specific vantage point
1. Some use simulated attack in real world as the combination of previous two scenarios. 
However, lacking of complexity, simulated events are quite platitude and regular. 
On the other hand, lacking of knowledge and motivation that drives each logs, manually identifying every group of events keeps no accuracy as well. Therefore, we attempt a complicated irregular emulated dataset based on IDS logs we collected from real word.
	

We do not conjure events. Instead, everything is sampled from real world data. We intentionally install several IDS in 5 Vantage Points. The collected logs include multiple periods within same VP from one or two IDS device. We mark this data sample as NKD-01. The detail of NKD-01 is listed in following table.

| Vantage Point | Period | # of Devices |    Rules   |   From Date  | To Date      | Total Days |  # of Logs |
|---------------|:------:|:------------:|:----------:|:------------:|--------------|:----------:|-----------:|
| ISP EDU       |    A   |       2      | Customized |  Sep. 8 2018 | Sep. 15 2018 |      7     |    391,257 |
| ISP EDU       |    B   |       2      | Customized | May 22 2019  | Jun. 25 2019 |     34     |  2,677,111 |
| Government C  |    A   |       1      |   ET PRO   | Oct. 13 2019 | Oct. 25 2019 |     12     |  1,743,444 |
| Government C  |    B   |       1      |   ET PRO   | Nov. 12 2019 | Dec. 11 2019 |     29     | 16,802,152 |
| Education L   |    A   |       1      |   ET PRO   | Oct. 13 2019 | Oct. 25 2019 |     12     |  8,995,867 |
| Research Y    |    A   |       1      |   ET PRO   | Dec. 3 2019  | Dec. 5 2019  |      3     |    368,697 |

For security and privacy reason, we mark each vantage point with its property category:	
- ISP EDU is a special Tier-2 ISP, which provides services for most universities and national institutions in China. We collect two periods of data from two backbone IDS located in Beijing, China. These two IDS are equally configured with same settings and using same hardware. They are also upgraded at the same time once the new version of settings are established. Note that both devices are upgraded multiple times simultaneously between Period A and B. They are served as front line filter for both servers of the ISP servers and other facilities within this ISP group. In the other VPs, we mirror all incoming and outgoing traffic of its backbone network in a parallel system. The application is installed in that system with a third-party software Network-Based IDS, and we configure it to use the latest ET Pro rules. 
- Education L locates in center Hunan province of China. It is a local vocational school with about 20 thousand students and employees. The network provides both wired and wireless access points. 
- Government C is a city-owned network system. It contains an official website allowing public access for a city government unit. In Period A, our system was not fully connected to whole network. Therefore, Period B stores about 10 times more records and only takes 2.4 times longer duration. 
- Research Y is a nation-owned research institution with its own network configuration.
	
We are unable to provide raw logs from these vantage points in public repository. If you need raw files for research and study purpose, please contact me in person.

## Emulation
We set our own IDS using ET rules under an emulated environment. To emulate near "real world" malicious traffics, our scripts using samples from our collected dataset by following rules:
1. All threat types are originated from NKD-01. The random sampling obeys the probability of its appearance. In addition, most attacks land on 10:00 am and then 2:00 pm with a 6:4 ratio according to our observation. 
2. Events generated by our scripts are referenced by the observation of replication patterns from \textit{NKD-01}, which we roughly classify into three types:
	1. **Singleton**. A Log or logs from a singleton event do not repeat more than 3 times and have no obvious relation with others. Singleton events are usually caused by policy violations, casual access or mis-routing traffics. 
	2. **Majority**. Majority events, typically DDoS attacks or botnet, are repetitive malicious activities that keeps traffic throw IDS. The duration of such type of event can be days or even weeks long, and they repeat more than thousand times. Thus, IDS has to constantly intercepts such type of events, which causes painful headache for administrators in reading IDS logs.
	3. **Ordinary**. The rest of logs apart from previous two types belong to ordinary events. They usually last for minutes to hours and repeats mostly dozens of times.
3. The distribution of different types is actually in inverse ratio of the number of repetitions of each type. In other words, singleton events occupy the largest portion of all events, which majority may only have rare different events. Meanwhile, the interval of flows launched by the scripts averages 8 seconds according to our observation.
4. Internal and External IP addresses are randomly picked from our predefined IP lists. Reserved IP ranges are excluded this time. IP address will have significantly less chance to be picked again. 
5. All simulated flows follow their characteristics of original threats, including its IP range selection, port number and attack pattern. For instance, DDoS attacks focus on a specific destination IP with a fixed port number, which acts as the victim.	
6. Return events have at least 1 hour intervals. We use the term of return event to describe same event that happened twice or more.
7. We use normal distribution for all time- and count-based randomization by default. An arguable observation is that some ordinary events may have potential connections. We find several such events, which shares no obvious feature unfortunately.
	
We normalized Customized ruleset compared with ET PRO. The settings of events for different dataset are as follows:

|        | Duration | Singleton % | Ordinary % | Majority % | Total Events |   Size  |
|--------|:--------:|-------------|------------|------------|--------------|:-------:|
| IURM_4 | 24 hr    | 85          | 12         | 3          | 2000         | 15MByte |
| IURM_5 | 24 hr    | 90          | 8          | 2          | 20000        | 86MByte |

Note that since the emulations do not starts at exact time. We **truncate** the data for better time alignment. Therefore, the total events and rate of events are not at exact number as well.

[1] Ring, Markus  and  Wunderlich, Sarah  and  Scheuring, Deniz  and  Landes, Dieter  and  Hotho, Andreas, "A Survey of Network-based Intrusion Detection Data Sets". Computers & Security. 2019.
